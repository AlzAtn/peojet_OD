<doctype>
<html>
	<head>
		<title>Index</title>
		<meta charset="utf-8"/>
		<script src="index.js"></script>
	</head>
	<body>
			<form action="/names" method="GET">
			<label>Inscrivez votre adresse : <input type="text" name="adresse" id="n"></label><br>
			<input type="submit" value="Envoyer" id="jsondwl">
			</form>
			
			<div id="d">
			</div>
<script>
jsonbtn = document.getElementById("jsonbtn");
csvbtn = document.getElementById("csvbtn");
jsondwl = document.getElementById("jsondwl");

function fetchehpadjson(route)
{
    fetch(route, 
                {
                    method: 'GET',
                    headers: { 'accept' : 'application/json'}
                }
            ).then(function(response){
                response.json().then(function(data)
                {
                    document.getElementById("d").innerHTML = JSON.stringify(data)
                })
            })
}
function fetchehpadcsv(route)
{
    fetch(route, 
                {
                    method: 'GET',
                    headers: { 'accept' : 'application/csv'}
                }
            ).then(function(response){
                response.blob().then(function(datablob)
                {
                    datablob.name = 'newfile.csv'
                    anchor = document.createElement('a')
                    anchor.download = datablob.name
                    anchor.href = window.URL.createObjectURL(datablob)
                    anchor.dataset.downloadurl = ['application/csv', anchor.download, anchor.href].join(':')
                    anchor.click()
                })
            })
}

function fetchehdwljson(route)
{
    fetch(route, 
                {
                    method: 'GET',
                    headers: { 'accept' : 'application/json'}
                }
            ).then(function(response){
                response.blob().then(function(datablob)
                {
                    datablob.name = 'newfile.json'
                    anchor = document.createElement('a')
                    anchor.download = datablob.name
                    anchor.href = window.URL.createObjectURL(datablob)
                    anchor.dataset.downloadurl = ['application/json', anchor.download, anchor.href].join(':')
                    anchor.click()
                })
            })
}

jsonbtn.onclick = function()
{
    console.log("clicked on json")
    fetchehpadjson(`/names`)
}
csvbtn.onclick = function()
{
    console.log("clicked on csv")
    fetchehpadcsv(`/names`)   
}

jsondwl.onclick = function()
{
    console.log("clicked on json")
    fetchehdwljson(`/names`)
}
</script>
	</body>
</html>